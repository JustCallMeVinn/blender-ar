<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AR Marker - Bumi 3D</title>

    <!-- A-Frame + AR.js -->
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ar.js@3.3.2/aframe/build/aframe-ar.min.js"></script>

    <style>
        body, html { margin: 0; padding: 0; overflow: hidden; }
        #info { 
            position: fixed;
            top: 15px; left: 15px;
            padding: 10px 15px;
            background: rgba(0,0,0,0.7);
            color: white;
            border-radius: 10px;
            font-size: 14px;
            z-index: 9999;
        }
        #controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            padding: 15px;
            background: rgba(0,0,0,0.8);
            border-radius: 10px;
            z-index: 9999;
        }
        button {
            padding: 10px 15px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover { background: #45a049; }
        #fileInput { display: none; }
    </style>
</head>

<body>

    <!-- UI -->
    <div id="info">
        <strong>üåç AR Bumi 3D</strong><br>
        Marker: <span id="markerStatus">Menunggu...</span><br>
        Model: <span id="modelStatus">Default Sphere</span>
    </div>

    <div id="controls">
        <button onclick="document.getElementById('fileInput').click()">üìÅ Upload bumi.glb</button>
        <button onclick="toggleRotation()">üîÑ Rotasi <span id="rotationState">ON</span></button>
    </div>

    <input type="file" id="fileInput" accept=".glb,.gltf">

    <!-- AR Scene -->
    <a-scene
        vr-mode-ui="enabled: false"
        embedded
        arjs="trackingMethod: best; sourceType: camera; debugUIEnabled: false;"
        renderer="colorManagement: true; physicallyCorrectLights: true;"
    >

        <!-- Marker HIRO -->
        <a-marker id="hiro" preset="hiro">
            <a-entity id="modelContainer" position="0 0 0" rotation="0 0 0"></a-entity>
        </a-marker>

        <!-- Camera -->
        <a-entity camera></a-entity>
    </a-scene>

    <!-- Script Model Loader -->
    <script>
        let autoRotate = true;
        let modelContainer = document.querySelector("#modelContainer");
        let marker = document.querySelector("#hiro");
        let model = null;

        // Marker status listener
        marker.addEventListener("markerFound", () => {
            document.getElementById("markerStatus").textContent = "Terdeteksi ‚úì";
        });

        marker.addEventListener("markerLost", () => {
            document.getElementById("markerStatus").textContent = "Tidak Terdeteksi";
        });

        // Default Sphere (placeholder)
        function loadDefaultSphere() {
            const sphere = document.createElement("a-sphere");
            sphere.setAttribute("radius", "0.5");
            sphere.setAttribute("color", "#2196F3");
            sphere.setAttribute("metalness", "0.3");
            sphere.setAttribute("roughness", "0.4");
            modelContainer.appendChild(sphere);
            model = sphere;
        }
        loadDefaultSphere();

        // File Upload
        document.getElementById("fileInput").addEventListener("change", function(event) {
            const file = event.target.files[0];
            if (!file) return;

            let url = URL.createObjectURL(file);

            // Hapus model lama
            if (model) model.remove();

            // Load GLB
            let entity = document.createElement("a-entity");
            entity.setAttribute("gltf-model", url);
            entity.setAttribute("scale", "0.5 0.5 0.5");
            modelContainer.appendChild(entity);
            model = entity;

            document.getElementById("modelStatus").textContent = file.name + " ‚úì";
        });

        // Rotasi
        function toggleRotation() {
            autoRotate = !autoRotate;
            document.getElementById("rotationState").textContent = autoRotate ? "ON" : "OFF";
        }

        // Auto-rotate update loop
        setInterval(() => {
            if (autoRotate && model) {
                let rot = model.getAttribute("rotation");
                model.setAttribute("rotation", {
                    x: rot.x,
                    y: rot.y + 1,
                    z: rot.z
                });
            }
        }, 40);
    </script>

</body>
</html>

